<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ù…</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }
    
    .animate-slide-in {
      animation: slideIn 0.4s ease-out forwards;
    }
    
    .stat-card {
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .progress-bar {
      transition: width 1s ease-in-out;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen p-4 md:p-6">
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <header class="max-w-6xl mx-auto mb-8 text-center animate-fade-in">
    <h1 class="text-3xl md:text-4xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2">
      <i class="fas fa-chart-line"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ù…
    </h1>
    <p class="text-gray-600">ØªØ§Ø¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ ÙˆØ£Ø¯Ø§Ø¡Ùƒ ÙÙŠ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ø§Ù…</p>
  </header>

  <main class="max-w-6xl mx-auto">
    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      <div class="stat-card bg-white rounded-xl shadow-md p-4 text-center animate-fade-in" style="animation-delay: 0.1s">
        <div class="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-check-circle text-2xl text-blue-600"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-700">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>
        <p class="text-3xl font-bold text-blue-700 mt-2" id="completedTasks">0</p>
        <p class="text-sm text-gray-500 mt-1">Ù…Ù† Ø£ØµÙ„ <span id="totalTasks">0</span> Ù…Ù‡Ù…Ø©</p>
      </div>

      <div class="stat-card bg-white rounded-xl shadow-md p-4 text-center animate-fade-in" style="animation-delay: 0.2s">
        <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-clock text-2xl text-green-600"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª</h3>
        <p class="text-3xl font-bold text-green-700 mt-2" id="totalTime">0</p>
        <p class="text-sm text-gray-500 mt-1">Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ø¹Ù…Ù„</p>
      </div>

      <div class="stat-card bg-white rounded-xl shadow-md p-4 text-center animate-fade-in" style="animation-delay: 0.3s">
        <div class="w-14 h-14 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-star text-2xl text-yellow-600"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-700">Ù…ØªÙˆØ³Ø· Ø§Ù„ØµØ¹ÙˆØ¨Ø©</h3>
        <p class="text-3xl font-bold text-yellow-700 mt-2" id="averageDifficulty">0</p>
        <p class="text-sm text-gray-500 mt-1">Ù…Ù† 5 Ù†Ù‚Ø§Ø·</p>
      </div>

      <div class="stat-card bg-white rounded-xl shadow-md p-4 text-center animate-fade-in" style="animation-delay: 0.4s">
        <div class="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-coins text-2xl text-purple-600"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
        <p class="text-3xl font-bold text-purple-700 mt-2" id="totalScore">0</p>
        <p class="text-sm text-gray-500 mt-1">Ù†Ù‚Ø·Ø© Ù…ÙƒØªØ³Ø¨Ø©</p>
      </div>
    </div>

    <!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø© -->
      <div class="bg-white rounded-xl shadow-md p-4 md:p-6 animate-fade-in" style="animation-delay: 0.5s">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-chart-pie"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
        </h2>
        <div class="h-64">
          <canvas id="difficultyChart"></canvas>
        </div>
      </div>

      <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© vs ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© -->
      <div class="bg-white rounded-xl shadow-md p-4 md:p-6 animate-fade-in" style="animation-delay: 0.6s">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-chart-bar"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
        </h2>
        <div class="h-64">
          <canvas id="completionChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- ØªÙ‚Ø¯Ù… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ø§Ù… -->
      <div class="bg-white rounded-xl shadow-md p-4 md:p-6 animate-fade-in" style="animation-delay: 0.7s">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-tasks"></i> ØªÙ‚Ø¯Ù… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ø§Ù…
        </h2>
        <div class="space-y-4">
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
              <span class="text-sm font-medium text-gray-700" id="completionRate">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
              <div id="completionProgress" class="progress-bar h-2.5 rounded-full bg-green-500" style="width: 0%"></div>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©</span>
              <span class="text-sm font-medium text-gray-700" id="productivityRate">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
              <div id="productivityProgress" class="progress-bar h-2.5 rounded-full bg-blue-500" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø© -->
      <div class="bg-white rounded-xl shadow-md p-4 md:p-6 animate-fade-in" style="animation-delay: 0.8s">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-history"></i> Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
        </h2>
        <div class="space-y-3" id="recentTasks">
          <p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯</p>
        </div>
      </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="flex flex-wrap gap-3 justify-center mb-8">
      <button onclick="resetAllData()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition flex items-center gap-2">
        <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      </button>
      <button onclick="exportData()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
        <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      </button>
      <button onclick="window.print()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition flex items-center gap-2">
        <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
      </button>
    </div>
  </main>

  <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
  <footer class="text-center mt-8 mb-4">
    <a href="index.html" class="inline-flex items-center gap-2 bg-white text-blue-700 px-4 py-2 rounded-lg shadow hover:bg-blue-50 transition">
      <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    </a>
    <p class="mt-4 text-sm text-gray-600">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ù… - Ø£Ø¯Ø§Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©</p>
  </footer>

  <script>
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    const score = parseInt(localStorage.getItem("score")) || 0;
    const weeklyTasks = JSON.parse(localStorage.getItem('weeklyTasks')) || {};
    const completedChallenges = parseInt(localStorage.getItem('completedChallenges') || '0');
    const challengePoints = parseInt(localStorage.getItem('totalChallengePoints') || '0');

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    const completedTasks = tasks.filter(t => t.completed);
    const totalTime = completedTasks.reduce((acc, t) => acc + (t.time || 0), 0);
    const avgDifficulty = completedTasks.length
      ? (completedTasks.reduce((acc, t) => acc + (t.difficulty || 0), 0) / completedTasks.length).toFixed(1)
      : 0;
    
    const completionRate = tasks.length > 0 ? Math.round((completedTasks.length / tasks.length) * 100) : 0;
    
    // Ø­Ø³Ø§Ø¨ ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
    const difficultyDistribution = {
      "Ø³Ù‡Ù„Ø©": completedTasks.filter(t => t.difficulty === 1).length,
      "Ø³Ù‡Ù„Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹": completedTasks.filter(t => t.difficulty === 2).length,
      "Ù…ØªÙˆØ³Ø·Ø©": completedTasks.filter(t => t.difficulty === 3).length,
      "ØµØ¹Ø¨Ø©": completedTasks.filter(t => t.difficulty === 4).length,
      "ØµØ¹Ø¨Ø© Ø¬Ø¯Ù‹Ø§": completedTasks.filter(t => t.difficulty === 5).length
    };

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    document.getElementById("completedTasks").textContent = completedTasks.length;
    document.getElementById("totalTasks").textContent = tasks.length;
    document.getElementById("totalTime").textContent = totalTime;
    document.getElementById("averageDifficulty").textContent = avgDifficulty;
    document.getElementById("totalScore").textContent = score + challengePoints;
    document.getElementById("completionRate").textContent = completionRate + "%";
    document.getElementById("completionProgress").style.width = completionRate + "%";
    
    // Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© (Ù…Ø²ÙŠØ¬ Ù…Ù† Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª)
    const productivityRate = Math.min(100, Math.round((completedTasks.length + completedChallenges) / (tasks.length > 0 ? tasks.length : 1) * 20));
    document.getElementById("productivityRate").textContent = productivityRate + "%";
    document.getElementById("productivityProgress").style.width = productivityRate + "%";
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø©
    const recentTasksContainer = document.getElementById("recentTasks");
    if (completedTasks.length > 0) {
      recentTasksContainer.innerHTML = '';
      const recentTasks = completedTasks.slice(-5).reverse();
      
      recentTasks.forEach(task => {
        const taskEl = document.createElement('div');
        taskEl.className = 'flex justify-between items-center p-2 bg-gray-50 rounded-lg';
        taskEl.innerHTML = `
          <div class="flex-1">
            <p class="text-sm font-medium text-gray-800">${task.name}</p>
            <p class="text-xs text-gray-500">${task.time} Ø¯Ù‚ÙŠÙ‚Ø© | ØµØ¹ÙˆØ¨Ø©: ${task.difficulty}/5</p>
          </div>
          <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Ù…ÙƒØªÙ…Ù„Ø©</span>
        `;
        recentTasksContainer.appendChild(taskEl);
      });
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
      // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
      const difficultyCtx = document.getElementById('difficultyChart').getContext('2d');
      new Chart(difficultyCtx, {
        type: 'pie',
        data: {
          labels: Object.keys(difficultyDistribution),
          datasets: [{
            data: Object.values(difficultyDistribution),
            backgroundColor: [
              '#4ade80', '#a3e635', '#fde047', '#fb923c', '#ef4444'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              rtl: true,
              labels: {
                font: {
                  family: 'Cairo'
                }
              }
            }
          }
        }
      });

      // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
      const completionCtx = document.getElementById('completionChart').getContext('2d');
      new Chart(completionCtx, {
        type: 'doughnut',
        data: {
          labels: ['Ù…ÙƒØªÙ…Ù„Ø©', 'ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©'],
          datasets: [{
            data: [completedTasks.length, tasks.length - completedTasks.length],
            backgroundColor: ['#10b981', '#e5e7eb'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              rtl: true,
              labels: {
                font: {
                  family: 'Cairo'
                }
              }
            }
          }
        }
      });
      
      // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„
      setTimeout(() => {
        document.querySelectorAll('.animate-fade-in').forEach((el, index) => {
          el.style.animationDelay = `${index * 0.1}s`;
        });
      }, 100);
    });

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ…
    function resetAllData() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
        localStorage.removeItem('tasks');
        localStorage.removeItem('score');
        localStorage.removeItem('weeklyTasks');
        localStorage.removeItem('completedChallenges');
        localStorage.removeItem('totalChallengePoints');
        alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        location.reload();
      }
    }

    function exportData() {
      const data = {
        tasks: tasks,
        score: score,
        weeklyTasks: weeklyTasks,
        completedChallenges: completedChallenges,
        challengePoints: challengePoints,
        generatedAt: new Date().toLocaleString('ar-SA')
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = `Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª_Ù…Ù‡Ø§Ù…_${new Date().toISOString().split('T')[0]}.json`;
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
    }
  </script>
</body>
          </html>
